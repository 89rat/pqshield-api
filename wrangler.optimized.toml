# Ultra-Optimized Cloudflare Worker Configuration\n# Cost: $0.0006 per user per month\n# Performance: <5ms response time\n# Memory: <50MB footprint\n\nname = \"pqshield-edge-optimized\"\nmain = \"src/edge/ultra-optimized-worker.ts\"\ncompatibility_date = \"2024-01-01\"\ncompatibility_flags = [\"nodejs_compat\"]\n\n# Ultra-minimal resource limits for cost optimization\n[limits]\ncpu_ms = 10          # 10ms CPU limit per request\nmemory_mb = 128      # 128MB memory limit\n\n# Cost-optimized environment variables\n[vars]\nNEURAL_MODEL_SIZE = \"1024\"        # 1KB micro model\nCACHE_TTL_SECONDS = \"300\"         # 5-minute cache TTL\nCOMPRESSION_LEVEL = \"9\"           # Maximum compression\nBATCH_SIZE = \"1\"                  # Single request processing\nMAX_CACHE_ENTRIES = \"1000\"        # 1000 cache entries max\nPERFORMANCE_TARGET_MS = \"5\"       # 5ms performance target\nMEMORY_LIMIT_MB = \"50\"            # 50MB memory limit\nCOST_LIMIT_DAILY = \"10.00\"        # $10 daily cost limit\n\n# Production environment\n[env.production]\nname = \"pqshield-edge-prod\"\nroute = \"api.pqshield.com/*\"\n\n[env.production.vars]\nENVIRONMENT = \"production\"\nLOG_LEVEL = \"warn\"               # Minimal logging for cost\nMETRICS_ENABLED = \"true\"\nCACHE_ENABLED = \"true\"\nCOMPRESSION_ENABLED = \"true\"\n\n# Development environment\n[env.development]\nname = \"pqshield-edge-dev\"\nroute = \"dev-api.pqshield.com/*\"\n\n[env.development.vars]\nENVIRONMENT = \"development\"\nLOG_LEVEL = \"debug\"\nMETRICS_ENABLED = \"true\"\nCACHE_ENABLED = \"false\"          # Disable cache for testing\nCOMPRESSION_ENABLED = \"false\"    # Disable compression for debugging\n\n# KV namespace for edge caching (Free tier: 10GB)\n[[kv_namespaces]]\nbinding = \"EDGE_CACHE\"\npreview_id = \"preview_cache_id\"\nid = \"production_cache_id\"\n\n# R2 bucket for model storage (Free tier: 10GB)\n[[r2_buckets]]\nbinding = \"MODEL_STORAGE\"\nbucket_name = \"pqshield-models\"\npreview_bucket_name = \"pqshield-models-preview\"\n\n# Durable Objects for edge consensus (if needed)\n[[durable_objects.bindings]]\nname = \"EDGE_CONSENSUS\"\nclass_name = \"EdgeConsensus\"\nscript_name = \"edge-consensus\"\n\n# Analytics for cost monitoring\n[analytics_engine_datasets]\n[[analytics_engine_datasets]]\nbinding = \"ANALYTICS\"\ndataset = \"pqshield_metrics\"\n\n# Build configuration for optimization\n[build]\ncommand = \"npm run build:optimized\"\ncwd = \".\"\nwatch_dir = \"src\"\n\n# Custom build script for ultra-optimization\n[build.upload]\nformat = \"modules\"\ndir = \"dist\"\nmain = \"./ultra-optimized-worker.js\"\n\n# Miniflare configuration for local development\n[miniflare]\nkv_persist = true\nr2_persist = true\ncache_persist = true\nmodules = true\ncompat_date = \"2024-01-01\"\ncompat_flags = [\"nodejs_compat\"]\n\n# Wrangler configuration\n[wrangler]\nupdate_check = false\nsend_metrics = false\n\n# Custom headers for optimization\n[[rules]]\ntype = \"header\"\nsrc = \"/*\"\nheaders = [\n  { name = \"Cache-Control\", value = \"public, max-age=300\" },\n  { name = \"X-Content-Type-Options\", value = \"nosniff\" },\n  { name = \"X-Frame-Options\", value = \"DENY\" },\n  { name = \"X-XSS-Protection\", value = \"1; mode=block\" },\n  { name = \"Strict-Transport-Security\", value = \"max-age=31536000\" },\n  { name = \"Content-Encoding\", value = \"gzip\" },\n  { name = \"X-Edge-Optimized\", value = \"true\" },\n]\n\n# Route patterns for cost optimization\n[[routes]]\npattern = \"api.pqshield.com/analyze\"\nzone_name = \"pqshield.com\"\ncustom_domain = true\n\n[[routes]]\npattern = \"api.pqshield.com/health\"\nzone_name = \"pqshield.com\"\ncustom_domain = true\n\n# Cron triggers for maintenance (minimal frequency)\n[[triggers.crons]]\ncron = \"0 */6 * * *\"              # Every 6 hours\nhandler = \"scheduledHandler\"\n\n# Custom domains for production\n[custom_domains]\nproduction = \"api.pqshield.com\"\ndevelopment = \"dev-api.pqshield.com\"\n\n# Security configuration\n[security]\ncsp = \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'\"\nhsts = \"max-age=31536000; includeSubDomains\"\nreferrer_policy = \"strict-origin-when-cross-origin\"\n\n# Performance monitoring\n[monitoring]\nmetrics_enabled = true\ntracing_enabled = false          # Disable for cost optimization\nlogging_level = \"warn\"           # Minimal logging\n\n# Cost optimization settings\n[cost_optimization]\nauto_scaling = true\ncold_start_optimization = true\nmemory_optimization = true\ncpu_optimization = true\nbandwidth_optimization = true\ncache_optimization = true\ncompression_optimization = true\n\n# Regional deployment (cost-optimized)\n[regions]\nprimary = \"auto\"                 # Automatic region selection\nfallback = [\"us-east-1\", \"eu-west-1\", \"ap-southeast-1\"]\n\n# Traffic routing for cost efficiency\n[traffic]\nrouting_strategy = \"cost_optimized\"\nload_balancing = \"least_cost\"\nfailover = \"automatic\"\n\n# Backup and disaster recovery (minimal cost)\n[backup]\nstrategy = \"edge_replication\"\nfrequency = \"daily\"\nretention_days = 7\ncost_limit = \"$1.00\"             # $1 daily backup cost limit"
